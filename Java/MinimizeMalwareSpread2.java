/**
 * Created on 16 Apr 2019 by happygirlzt
 *
 * LeetCode #928. Minimize Malware Spread II
 *
 */

class Solution {
    public int minMalwareSpread(int[][] graph, int[] initial) {
        Arrays.sort(initial);
        int n = graph.length;
        Set<Integer> mal = new HashSet<>();
        for (int i : initial) {
            mal.add(i);
        }

        int num = -1;
        int res = -1;
        for (int i : initial) {
            Set<Integer> visited = new HashSet<>();
            visited.add(i);
            int save = 0;
            for (int j = 0; j < n; j++) {
                if (i != j && graph[i][j] == 1) {
                    int tmp = dfs(j, visited, mal, graph);
                    if (tmp < 0) continue;
                    save += tmp;
                }
            }

            if (save > num) {
                num = save;
                res = i;
            }
        }

        return res;
    }

    private int dfs(int node, Set<Integer> visited, Set<Integer> mal, int[][] graph) {
        if (!visited.add(node)) return 0;
        if (mal.contains(node)) return -1;

        int saved = 1;
        for (int j = 0; j < graph.length; j++) {
            if (node != j && graph[node][j] == 1) {
                int tmp = dfs(j, visited, mal, graph);
                if (tmp < 0) {
                    mal.add(node);
                    return -1;
                }

                saved += tmp;
            }
        }

        return saved;
    }
}
